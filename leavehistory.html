<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NCP Bookkeeping</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="/ncpicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/ncpicon.ico" type="image/x-icon">
</head>
<body>
<div class="container leave-card">
  <h1>My Leave History</h1>

  <div id="historyLoading" class="google-loading">
    <div class="page-spinner"></div>
    Loading your leave historyâ€¦
  </div>

  <div id="leaveList"></div>

  <div id="emptyState" class="empty-state hidden">
    No leave records found.
  </div>
</div>

<script>
const token = sessionStorage.getItem("employeeToken");

if (!token) {
  alert("Session expired. Please log in again.");
  window.location.href = "employee-login.html";
}

// ðŸ” SECURE FETCH (NO employeeId, NO URL params)
fetch(SCRIPT_URL, {
  method: "POST",
  body: new URLSearchParams({
    action: "getLeaveHistorySecure",
    token
  })
})
  .then(res => res.json())
  .then(res => {
    document.getElementById("historyLoading").classList.add("hidden");

    if (!res.success || res.data.length === 0) {
      document.getElementById("emptyState").classList.remove("hidden");
      return;
    }

    const list = document.getElementById("leaveList");
    list.innerHTML = "";

    res.data.forEach(l => {
      const card = document.createElement("div");
      card.className = "request-card";

      card.innerHTML = `
        <div class="request-top">
          <div class="leave-type">${l.type}</div>
          <span class="status-badge ${l.status.toLowerCase()}">
            ${l.status}
          </span>
        </div>

        <div class="dates">
          ${l.start} â†’ ${l.end}
        </div>

        <div class="reason">${l.reason}</div>
      `;

      list.appendChild(card);
    });
  })
  .catch(err => {
    console.error(err);
    document.getElementById("historyLoading").textContent =
      "Failed to load leave history";
  });
  
  
</script>


</body>
</html>
